## 项目搭建

### 包管理器

我们此处是使用nodejs来进行项目的搭建的，关于nodejs的环境搭建前面章节已经介绍过，在此处就不再赘述。这次我们主要来学习一下nodejs依赖包的管理。

如同java拥有Maven，ruby拥有gem一样，nodejs也有自己的包管理器——npm。

其实当我们搭建好nodejs的环境时，就已经顺带安装好npm了。现在我们打开命令行，假设我们打开的命令行所在的目录是`E:\workspace\blog`，我们在命令行敲入`npm install express`，然后我们就会看到在`E:\workspace\blog`目录下生成了一个**node_modules**文件夹，里面会包含一个或若干个文件夹。实际上我们已经将一个npm包——**express**安装到`E:\workspace\blog`目录了。

接下来我们可以像在前面章节学过的那样，在`E:\workspace\blog`下创建文件app.js，然后在里面追加内容：

```javascript
var express = require('express');

// do something
```

这样，我们就可以使用express这个模块了。

>假设我们想把包安装在全局环境而非命令行所在的目录，则可以在命令行中敲入`npm install -g express`，其中`-g`参数就会告诉npm要将包安装在全局环境中。

### package.json

通常来说一个项目可能在不同的开发者手上并行开发。对于这种情况如果项目里依赖的包有很多的话，我们总不能给每个开发者个列表让他们逐个包安装吧？为了解决这种情况，最常见的做法就是在项目里安放一个配置文件，而npm是默认使用**package.json**作为项目的配置文件的。

顾名思义，package.json就是一个json文件，里面包含有项目名称、版本号、描述与关键字、启动脚本、模块入口和项目依赖等信息，通常放在项目根目录里面。既然这里面保存有依赖信息，那么只要我们安装依赖包的时候同时把依赖信息添加进这里面，这样别人也能获取到依赖相关的信息。

因此我们先在`E:\workspace\blog`目录下执行命令`npm init`，按照文字指引填写一系列信息，当最终确认完成后，我们会发现在`E:\workspace\blog`目录下多了一个package.json文件。然后我们在安装模块包的时候用`npm install --save express`来代理上面提到的`npm install express`。这个时候对于express模块的依赖会添加到package.json里的**dependencies**字段里面去。当别人拿到这个项目的时候直接在package.json所在目录下执行命令`npm install`就会自动安装此项目所有的依赖了。

>当大家拿到这个项目源码的时候，也要在package.json所在目录执行一下`npm install`安装依赖包，等安装完之后在能启动博客系统。

### 分层架构

一般来说，后端的业务代码不会只写在一个文件里的。当然，加入整个系统的逻辑很简单，把所有代码囊括在一个文件里也不难维护，但是当业务渐渐复杂起来后，只有一个源码文件会导致协作困难，修改困难等各种各样的难题。

就跟前端一样，前端会讲究模块化，后端也可以将就模块化。在使用nodejs的后端环境里，通常一个文件就是一个模块。

假若之前我们定义好的需求，我们这个博客系统有两个业务模块——用户模块和博客模块，这样我们可以纵向的将这个博客系统的后端切成三个js文件：用户模块文件、博客模块文件和系统的入口文件。但是如果按照这种分法，一个用户模块文件里会包含处理路由跳转的逻辑、处理数据校验的逻辑、判断登录注册的逻辑、操作数据库的逻辑和组装返回数据的逻辑等，整个文件里面包含的逻辑还是很庞大，也就是说我们切分系统的粒度还是太粗。 

既然纵向切过了，那我们可不可以横向再把这个系统切上几刀？答案显然是可以的，这时候我们就得提出在后端领域经常被人提及的三层架构。

* 表示层：通常是指视图和路由相关的逻辑层面，包括数据模型的转换、

### 目录搭建

项目的目录通常依团队风格、技术选型而定的，我这里提供一个我常使用的目录结构：

```
blog
 |----doc // 放置项目文档
 |----node_modules 
 |----src // 放置后端源码文件
 |     |----controller // 放置表示层文件
 |     |----service // 放置业务逻辑层文件
 |     |----dao // 放置数据访问层文件
 |     |----filter // 放置过滤器层文件
 |     |----views // 放置视图文件
 |     |----util // 放置通用工具文件
 |     |----app.js // 服务器启动入口
 |----logs // 放置日志文件
 |----webapp // 放置前端相关资源，如图片资源、js资源和css资源等
 |----package.json
 |----README.md
```

在这里，前端的目录结构就不再做过多解释了，这里主要来介绍一下后端的目录结构。



